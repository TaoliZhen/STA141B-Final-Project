---
title: "final_project_api_testing"
author: "Taoli Zhen"
date: "6/3/2020"
output: html_document
---

```{r message=FALSE}
library(httr)
library(tidyverse)
library(jsonlite)
```

# Open Skills API

## Job Title Autocomplete and suggestions
```{r}
r <- GET(
  "http://api.dataatwork.org/v1/jobs/autocomplete",
  query = list(
    contains = "financial analyst"
    #begins_with = 
    #ends_with = 
    # can use only one of them
  )
)
stop_for_status(r)
json <- content(r, as = "text")
df_jobtitle <- fromJSON(json, flatten = TRUE) %>% 
  as.data.frame()
df_jobtitle
jobid <- df_jobtitle %>% filter(suggestion == "Financial Analyst") %>% select(uuid)
```

## Autocomplete skill name
```{r}
r <- GET(
  "http://api.dataatwork.org/v1/skills/autocomplete",
  query = list(
    contains = "python"
    #begins_with = 
    #ends_with = 
    # can use only one of them
  )
)
stop_for_status(r)
json <- content(r, as = "text")
df <- fromJSON(json, flatten = TRUE) %>% 
  as.data.frame()
df
```

## Normalize skill name
```{r}
r <- GET(
  "http://api.dataatwork.org/v1/skills/normalize",
  query = list(
    skill_name = "programming"
  )
)
stop_for_status(r)
json <- content(r, as = "text")
df <- fromJSON(json, flatten = TRUE) %>% 
  as.data.frame()
df
```

## Get Associated Skills for a Job
```{r}
r <- GET(
  str_glue("http://api.dataatwork.org/v1/jobs/{uuid}/related_skills", uuid = jobid$uuid),
  query = list(
    
    #begins_with = 
    #ends_with = 
    # can use only one of them
  )
)
stop_for_status(r)
json <- content(r, as = "text")
df_related_skills <- fromJSON(json, flatten = TRUE) %>% 
  as.data.frame()
df_related_skills
```



# balldontlie API NBA stats

## Get All Players
```{r}
r <- GET(
  "https://www.balldontlie.io/api/v1/players",
  query = list(
    search = "curry",
    per_page = "100"
    #page = 
  )
)
stop_for_status(r)
json <- content(r, as = "text")
df <- fromJSON(json, flatten = TRUE) 
df$data
```

## Get a Specific Player
```{r}
id <- "1043"
r <- GET(
  "https://www.balldontlie.io/api/v1/players/1043",
  query = list(
    #ID = "1043"
  )
)
stop_for_status(r)
json <- content(r, as = "text")
df <- fromJSON(json)
df
```

## Get All teams
```{r}
r <- GET(
  "https://www.balldontlie.io/api/v1/teams",
  query = list(
  )
)
stop_for_status(r)
json <- content(r, as = "text")
df <- fromJSON(json, flatten = TRUE)
df$data
```

## Get a Specific Team
same as Get a Specific Player

##Get All Stats
```{r}
r <- GET(
  "https://www.balldontlie.io/api/v1/stats",
  query = list(
  )
)
stop_for_status(r)
json <- content(r, as = "text")
df <- fromJSON(json, flatten = TRUE)
df$data
```

## Get Season Averages
```{r}
r <- GET(
  "https://www.balldontlie.io/api/v1/season_averages",
  query = list(
    season = "2019",
    player_ids = "5"
  )
)
stop_for_status(r)
json <- content(r, as = "text")
df <- fromJSON(json, flatten = TRUE) 
df$data
```




# API key for Alpha Vantage Stock API
G3O0P1B2VGOZYKZN

## TIME_SERIES_DAILY Closing price for the past 100 days
```{r message=FALSE}
r <- GET(
  "https://www.alphavantage.co/query?function=TIME_SERIES_DAILY",
  query = list(
    symbol = "AAPL",
    apikey = "G3O0P1B2VGOZYKZN"
  )
)
stop_for_status(r)
json <- content(r, as = "text", encoding = "UTF-8")
df_daily <- fromJSON(json, flatten = TRUE) %>% 
  as.data.frame() %>%
  select(symbol = ends_with("Symbol"), ends_with("close")) %>% 
  pivot_longer(
    starts_with("Time.Series..Daily.."),
    names_to = "date",
    names_prefix = "Time.Series..Daily.."
  ) %>% 
  separate(col = "date", c("year", "month","date"), sep = "[.]") %>% 
  unite(col = "date", 2:4, sep = "/") %>% 
  mutate(
    date = as.Date(date),
    value = as.numeric(as.character(value))
    )
df_daily
```

### graph the result
Graph reference: https://blog.revolutionanalytics.com/2015/08/plotting-time-series-in-r.html
```{r}
ggplot(df_daily, aes(x = date, y = value)) +
  geom_line() +
  ggtitle("Closing Stock Prices: APPLE") +
  theme(plot.title = element_text(lineheight=2, face="bold"))
```


## TIME_SERIES_WEEKLY Closing price
```{r message=FALSE}
r <- GET(
  "https://www.alphavantage.co/query?function=TIME_SERIES_WEEKLY",
  query = list(
    symbol = "AAPL",
    apikey = "G3O0P1B2VGOZYKZN"
  )
)
stop_for_status(r)
json <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(json, flatten = TRUE) %>% 
  as.data.frame() %>%
  select(symbol = ends_with("Symbol"), ends_with("close")) %>% 
  pivot_longer(
    starts_with("Weekly.Time.Series."),
    names_to = "date",
    names_prefix = "Weekly.Time.Series."
  ) %>% 
  separate(col = "date", c("year", "month","date"), sep = "[.]") %>% 
  unite(col = "date", 2:4, sep = "/") %>% 
  mutate(
    date = as.Date(date),
    value = as.numeric(as.character(value))
    )
df
```

## TIME_SERIES_MONTHLY Closing price
```{r message=FALSE}
r <- GET(
  "https://www.alphavantage.co/query?function=TIME_SERIES_MONTHLY",
  query = list(
    symbol = "AAPL",
    apikey = "G3O0P1B2VGOZYKZN"
  )
)
stop_for_status(r)
json <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(json, flatten = TRUE) %>% 
  as.data.frame() %>%
  select(symbol = ends_with("Symbol"), ends_with("close")) %>% 
  pivot_longer(
    starts_with("Monthly.Time.Series."),
    names_to = "date",
    names_prefix = "Monthly.Time.Series."
  ) %>% 
  separate(col = "date", c("year", "month","date"), sep = "[.]") %>% 
  unite(col = "date", 2:4, sep = "/") %>% 
  mutate(
    date = as.Date(date),
    value = as.numeric(as.character(value))
    )
df
```

## WMA 5-day daily ma for the past 90 days
```{r}
r <- GET(
  "https://www.alphavantage.co/query?function=WMA",
  query = list(
    symbol = "AAPL",
    interval = "daily",
    time_period = 5,
    series_type = "close",
    apikey = "G3O0P1B2VGOZYKZN"
  )
)
stop_for_status(r)
json <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(json, flatten = TRUE) %>% 
  as.data.frame() %>%
  select(symbol = ends_with("Symbol"), time_point = ends_with("Type"), starts_with("Technical.Analysis")) %>% 
  pivot_longer(
    starts_with("Technical.Analysis"),
    names_to = "ma_lag",
    names_prefix = "Technical.Analysis..WMA."
  ) %>% 
  head(91) %>% 
  separate(col = "ma_lag", c("indicator", "lag"), sep = "[.]") %>% 
  mutate(lag = replace_na(lag, "0"),
         lag = as.factor(lag))
df
```

## WMA 30-day daily ma for the past 90 days
```{r}
r <- GET(
  "https://www.alphavantage.co/query?function=WMA",
  query = list(
    symbol = "AAPL",
    interval = "daily",
    time_period = 30,
    series_type = "close",
    apikey = "G3O0P1B2VGOZYKZN"
  )
)
stop_for_status(r)
json <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(json, flatten = TRUE) %>% 
  as.data.frame() %>%
  select(symbol = ends_with("Symbol"), time_point = ends_with("Type"), starts_with("Technical.Analysis")) %>% 
  pivot_longer(
    starts_with("Technical.Analysis"),
    names_to = "ma_lag",
    names_prefix = "Technical.Analysis..WMA."
  ) %>% 
  head(91) %>% 
  separate(col = "ma_lag", c("indicator", "lag"), sep = "[.]") %>% 
    mutate(lag = replace_na(lag, "0"),
         lag = as.factor(lag))
df
```

## SMA 5-day daily ma for the past 90 days
```{r}
r <- GET(
  "https://www.alphavantage.co/query?function=SMA",
  query = list(
    symbol = "AAPL",
    interval = "daily",
    time_period = 5,
    series_type = "close",
    apikey = "G3O0P1B2VGOZYKZN"
  )
)
stop_for_status(r)
json <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(json, flatten = TRUE) %>% 
  as.data.frame() %>%
  select(symbol = ends_with("Symbol"), time_point = ends_with("Type"), starts_with("Technical.Analysis")) %>% 
  pivot_longer(
    starts_with("Technical.Analysis"),
    names_to = "ma_lag",
    names_prefix = "Technical.Analysis..WMA."
  ) %>% 
  head(91) %>% 
  separate(col = "ma_lag", c("indicator", "lag"), sep = "[.]") %>% 
  mutate(lag = replace_na(lag, "0"),
         lag = as.factor(lag))
df
```

## SMA 30-day daily ma for the past 90 days
```{r}
r <- GET(
  "https://www.alphavantage.co/query?function=SMA",
  query = list(
    symbol = "AAPL",
    interval = "daily",
    time_period = 30,
    series_type = "close",
    apikey = "G3O0P1B2VGOZYKZN"
  )
)
stop_for_status(r)
json <- content(r, as = "text", encoding = "UTF-8")
df <- fromJSON(json, flatten = TRUE) %>% 
  as.data.frame() %>%
  select(symbol = ends_with("Symbol"), time_point = ends_with("Type"), starts_with("Technical.Analysis")) %>% 
  pivot_longer(
    starts_with("Technical.Analysis"),
    names_to = "ma_lag",
    names_prefix = "Technical.Analysis..WMA."
  ) %>% 
  head(91) %>% 
  separate(col = "ma_lag", c("indicator", "lag"), sep = "[.]") %>% 
    mutate(lag = replace_na(lag, "0"),
         lag = as.factor(lag))
df
```